# Κλάσεις

## Client

Είναι η υλοποίηση του προγράμματος-πελάτη. Όταν εκτελείται η main αυτής της κλάσης δημιουργείται ένα αντικείμενο Client το οποίο αναλαμβάνει να συνδεθεί στον server με IP και Port αυτά που έχει δώσει ο χρήστης σαν 1η και 2η παράμετρο κι έπειτα εκτελεί την λειτουργία που αντιστοιχεί στην 3η παράμετρο. Σε κάθε περίπτωση στέλνει στον server τις απαιτούμενες (με βάση την λειτουργία) παραμέτρους και τυπώνει στον χρήστη την απάντηση του server.

## Message

Είναι η κλάση που αναπαριστά ένα μήνυμα. Περιέχει τα εξής πεδία:

- `String sender` το username του αποστολέα
- `String receiver` το username του παραλήπτη
- `String body` το κείμενο του μηνύματος
- `Integer ID` το μοναδικό (για τον ιδιοκτήτη) id του μηνύματος
- `boolean isRead` αν το μήνυμα έχει διαβαστεί ή όχι,

έναν Constructor που τα αρχικοποιεί όλα με τις δοσμένες τιμές και τους κατάλληλους getters και setters.

## Account

Είναι η κλάση που αναπαριστά έναν λογαριασμό. Περιέχει τα εξής πεδία:

- `String username` το username του χρήστη
- `String authToken` το μοναδικό token του χρήστη
- `List<Message> messageBox` η λίστα με τα μηνύματα του χρήστη

και 

- `Integer msgID` ένας μετρητής που αυξάνεται κάθε φορά που ο χρήστης λαμβάνει ένα μήνυμα

Επίσης έχει έναν Constructor που τα αρχικοποιεί όλα με τις δοσμένες τιμές και τους κατάλληλους getters και setters.

## Database

Είναι η κλάση που διαχειρίζεται τις λίστες με τους λογαριασμούς και τα μηνύματα. Περιέχει τα εξής πεδία:

- `Map<String, Account> usernameToAccount` ένα Map που αντιστοιχεί το username ενός χρήστη στον λογαριασμό του
- `Map<Account, Integer> accountToToken` ένα Map που αντιστοιχεί τον λογαριασμό ενός χρήστη στο AuthToken του
- `Map<Integer, Account> tokenToAccount` ένα Map που αντιστοιχεί το AuthToken ενός χρήστη στον λογαριασμό του

Εκτός από τον Constructor που αρχικοποιεί τα άδεια Maps, έχει τις εξής μεθόδους:

- `public String createAccount(String username)` εφόσον το username δεν χρησιμοποιείται και αποτελείται μόνο από αλφαριθμητικά και '_' φτιάχνει τον καινούριο λογαριασμό τον καταχωρεί στους πίνακες και επιστρέφει το AuthToken του, αλλιώς επιστρέφει το κατάλληλο μήνυμα λάθους
- `public String showAccounts(Integer authToken)` επιστρέφει την λίστα με όλα τα username των χρηστών
- `public String sendMessage(Integer authToken, String recipient, String body)` εφόσον υπάρχει χρήστης με το username recipient φτιάχνει ένα νέο μήνυμα, το προσθέτει στην λίστα μηνυμάτων του παραλήπτη και επιστρέφει "ΟΚ", αλλιώς επιστρέφει το κατάλληλο μήνυμα λάθους
- `public String showInbox(Integer authToken)` επιστρέφει την λίστα με όλα τα μηνύματα του χρήστη με το AuthToken authToken
- `public String readMessage(Integer authToken, Integer msgID)` εφόσον ο χρήστης έχει μήνυμα με το msgID το σημαδεύει ως διαβασμένο και επιστρέφει τον αποστολέα και το κείμενο του, αλλιώς επιστρέφει το κατάλληλο μήνυμα λάθους
- `public String deleteMessage(Integer authToken, Integer msgID)` εφόσον ο χρήστης έχει μήνυμα με το msgID το διαγράφει και επιστρέφει "ΟΚ", αλλιώς επιστρέφει το κατάλληλο μήνυμα λάθους

## RequestHandler

Είναι η κλάση που αναλαμβάνει να εκτελέσει τις λειτουργίες που ζητάει ο Client και είναι επέκταση της κλάσσης Thread ώστε να επιτρέπει την παράλληλη διαχείριση των Requests. Στην μέθοδο `run()` φτιάχνει τα κανάλια επικοινωνίας με τον Client, διαβάζει το αναγνωριστικό της λειτουργίας που θέλει να εκτελέσει ο Client και στην συνέχεια διαβάζει τις απαραίτητες παραμέτρους και στέλνει στον Client την απάντηση που προκύπτει από την κλήση της αντίστοιχης μεθόδου της κλάσης Database.

## Server

Είναι η υλοποίηση του προγράμματος-εξυπηρετητή. Όταν εκτελείται η main αυτής της κλάσης δημιουργείται ένα αντικείμενο Server το οποίο κατασκευάζει ένα νεό αντικείμενο Database, δημιουργεί ένα νέο ServerSocket στο Port που έχει δώσει ο χρήστης σαν 1η παράμετρο και φτιάχνει ένα νέο RequestHandler για κάθε νέο Client που συνδέεται.

# Παρατηρήσεις 

## #1
Θεωρούμε ότι ο χρήστης θα δίνει σωστό πλήθος και τύπο παραμέτρων στο πρόγραμμα-πελάτη αλλά όχι απαραίτητα σωστές τιμές.

π.χ. Αν ο χρήστης θέλει να στείλει ένα μήνυμα σε έναν άλλο χρήστη και εκτελέσει την εντολή:

```bash
java -jar jars\Client.jar localhost 5000 3 1024 user1 "Hello user1"
```

το πρόγραμμα θα τρέξει χωρίς σφάλματα ακόμα κι αν δεν υπάρχει ο χρήστης με AuthToken 1024 ή αν δεν υπάρχει ο χρήστης με username user1.

Αντίθετα αν για 4η παράμετρο βάλει λέξη που δεν περιέχει μόνο νούμερα ή δεν βάλει το "Hello user1" θα πετάξει σφάλμα.

## #2
Σε κάθε περίπτωση όταν το authToken που δίνεται δεν είναι έγκυρο η απάντηση του server θα είναι "Invalid Auth Token".